# CREATE SCHEMA INM;

CREATE TABLE INM.CATEGORY
(
    ID        INT PRIMARY KEY AUTO_INCREMENT,
    LEVEL     INT         NOT NULL,
    LEFTKEY   INT         NOT NULL,
    RIGHTKEY  INT         NOT NULL,
    TITLE     VARCHAR(45) NOT NULL,
    PARENT_ID INT         NOT NULL,
    INDEX LEFTKEY (LEFTKEY, RIGHTKEY, LEVEL)
);

CREATE TABLE INM.DEPARTMENT
(
    ID    INT PRIMARY KEY,
    TITLE VARCHAR(255) NOT NULL
);

CREATE TABLE INM.USERSGROUP
(
    ID   INT PRIMARY KEY,
    NAME VARCHAR(255)
);

CREATE TABLE INM.USERS
(
    ID        INT PRIMARY KEY,
    LOGIN     VARCHAR(255) NOT NULL,
    PASSWORD  VARCHAR(255) NOT NULL,
    NAME      VARCHAR(255) NOT NULL,
    USERGROUP INT          NOT NULL,
    CONTACTS  VARCHAR(255),
    EMAIL     VARCHAR(255),
    CONSTRAINT FK_USERGROUP FOREIGN KEY (USERGROUP)
        REFERENCES USERSGROUP (ID)
);

CREATE TABLE INM.STATUS
(
    ID    INT PRIMARY KEY,
    TITLE VARCHAR(255) NOT NULL
);

CREATE TABLE INM.PRIORITY
(
    ID          INT PRIMARY KEY,
    INFLUENCE   INT          NOT NULL,
    URGENCY     INT          NOT NULL,
    DESCRIPTION VARCHAR(100) NOT NULL,
    TERM        INT          NOT NULL
);

CREATE TABLE INM.INCIDENT
(
    ID                  INT PRIMARY KEY AUTO_INCREMENT,
    DATE                TIMESTAMP    NOT NULL,
    CATEGORY            INT          NOT NULL,
    PRIORITY            INT          NOT NULL,
    REQUESTERDEPARTMENT INT          NOT NULL,
    REQUESTER           VARCHAR(255) NOT NULL,
    REQUESTERCONTACTS   VARCHAR(45)  NOT NULL,
    IPADDRESS           VARCHAR(16),
    DURATION            INT,
    DESCRIPTION         VARCHAR(255),
    ENGINEER            INT,
    OPERATOR            INT          NOT NULL,
    STATUS              INT          NOT NULL,
    CLOSEDATE           TIMESTAMP,
    JOURNAL             TEXT,
    CONSTRAINT FK_CATEGORY FOREIGN KEY (CATEGORY)
        REFERENCES CATEGORY (ID),
    CONSTRAINT FK_PRIORITY FOREIGN KEY (PRIORITY)
        REFERENCES PRIORITY (ID),
    CONSTRAINT FK_DEPARTMENT FOREIGN KEY (REQUESTERDEPARTMENT)
        REFERENCES DEPARTMENT (ID),
    CONSTRAINT FK_ENGINEER FOREIGN KEY (ENGINEER)
        REFERENCES USERS (ID),
    CONSTRAINT FK_OPERATOR FOREIGN KEY (OPERATOR)
        REFERENCES USERS (ID),
    CONSTRAINT FK_STATUS FOREIGN KEY (STATUS)
        REFERENCES status (ID)
);