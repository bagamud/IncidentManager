# CREATE SCHEMA INM;

CREATE TABLE INM.CATEGORY
(
    ID        INT PRIMARY KEY AUTO_INCREMENT,
    LEVEL     INT         NOT NULL,
    LEFT_KEY  INT         NOT NULL,
    RIGHT_KEY INT         NOT NULL,
    TITLE     VARCHAR(45) NOT NULL,
    PARENT_ID INT         NOT NULL,
    INDEX LEFT_KEY (LEFT_KEY, RIGHT_KEY, LEVEL)
);

CREATE TABLE INM.DEPARTMENT
(
    ID    INT PRIMARY KEY,
    TITLE VARCHAR(255) NOT NULL
);

CREATE TABLE INM.USERS_GROUP
(
    ID   INT PRIMARY KEY,
    NAME VARCHAR(255)
);

CREATE TABLE INM.USERS
(
    ID         INT PRIMARY KEY,
    LOGIN      VARCHAR(255) NOT NULL,
    PASSWORD   VARCHAR(255) NOT NULL,
    NAME       VARCHAR(255) NOT NULL,
    USER_GROUP INT          NOT NULL,
    CONTACTS   VARCHAR(255),
    EMAIL      VARCHAR(255),
    CONSTRAINT FK_USER_GROUP FOREIGN KEY (USER_GROUP)
        REFERENCES USERS_GROUP (ID)
);

CREATE TABLE INM.INC_STATUS
(
    ID    INT PRIMARY KEY,
    TITLE VARCHAR(255) NOT NULL
);

CREATE TABLE INM.PRIORITY
(
    ID          INT PRIMARY KEY,
    INFLUENCE   INT          NOT NULL,
    URGENCY     INT          NOT NULL,
    DESCRIPTION VARCHAR(100) NOT NULL,
    TERM        INT          NOT NULL
);

CREATE TABLE INM.INCIDENT
(
    ID                   INT PRIMARY KEY AUTO_INCREMENT,
    DATE                 TIMESTAMP    NOT NULL,
    CATEGORY             INT          NOT NULL,
    PRIORITY             INT          NOT NULL,
    REQUESTER_DEPARTMENT INT          NOT NULL,
    REQUESTER            VARCHAR(255) NOT NULL,
    REQUESTER_CONTACTS   VARCHAR(45)  NOT NULL,
    IP_ADDRESS           VARCHAR(16),
    DURATION             INT,
    DESCRIPTION          VARCHAR(255),
    ENGINEER             INT,
    OPERATOR             INT          NOT NULL,
    STATUS               INT          NOT NULL,
    CLOSE_DATE           TIMESTAMP,
    JOURNAL              TEXT,
    CONSTRAINT FK_CATEGORY FOREIGN KEY (CATEGORY)
        REFERENCES CATEGORY (ID),
    CONSTRAINT FK_PRIORITY FOREIGN KEY (PRIORITY)
        REFERENCES PRIORITY (ID),
    CONSTRAINT FK_DEPARTMENT FOREIGN KEY (REQUESTER_DEPARTMENT)
        REFERENCES DEPARTMENT (ID),
    CONSTRAINT FK_ENGINEER FOREIGN KEY (ENGINEER)
        REFERENCES USERS (ID),
    CONSTRAINT FK_OPERATOR FOREIGN KEY (OPERATOR)
        REFERENCES USERS (ID),
    CONSTRAINT FK_STATUS FOREIGN KEY (STATUS)
        REFERENCES INC_STATUS (ID)
);